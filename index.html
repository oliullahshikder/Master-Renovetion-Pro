<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Pro: Stable Prompt Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #4f46e5; --glass: rgba(15, 23, 42, 0.95); }
        body {
            font-family: 'Rajdhani', sans-serif;
            background-color: #050505;
            background-image: linear-gradient(rgba(0, 255, 170, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 255, 170, 0.03) 1px, transparent 1px);
            background-size: 40px 40px; color: white; min-height: 100vh;
            display: flex; align-items: center; justify-content: center; padding: 20px; overflow-x: hidden;
        }
        .cyber-wrapper {
            background: rgba(10, 10, 20, 0.95); border-radius: 40px;
            box-shadow: 0 0 0 2px #1e293b, 0 0 30px rgba(56, 189, 248, 0.15);
            width: 100%; max-width: 900px; padding: 40px 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        /* Buttons */
        .android-btn {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border-radius: 20px; padding: 15px 10px; cursor: pointer; transition: transform 0.1s ease;
            width: 100%; height: 110px; border: none; user-select: none; color: white; font-weight: bold;
        }
        .btn-strict { background: linear-gradient(180deg, #0ea5e9 0%, #0369a1 100%); box-shadow: 0px 6px 0px #0c4a6e; }
        .btn-auto { background: linear-gradient(180deg, #d946ef 0%, #a21caf 100%); box-shadow: 0px 6px 0px #701a75; }
        .btn-reverse { background: linear-gradient(180deg, #f97316 0%, #c2410c 100%); box-shadow: 0px 6px 0px #7c2d12; }
        .android-btn.selected { transform: translateY(6px); box-shadow: inset 0px 5px 10px rgba(0,0,0,0.4); filter: brightness(1.2); border: 2px solid white; }
        
        .input-3d { background: rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.15); border-radius: 12px; color: white; transition: 0.3s; }
        .input-3d:focus { border-color: #38bdf8; background: rgba(0,0,0,0.9); outline: none; }
        
        .round-btn {
            width: 100%; padding: 15px; border-radius: 12px; font-weight: bold; cursor: pointer; text-transform: uppercase;
            box-shadow: 0 4px 0 rgba(0,0,0,0.3); transition: all 0.1s; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .round-btn:active { transform: translateY(4px); box-shadow: none; }
        .btn-online { background: linear-gradient(90deg, #3b82f6, #8b5cf6); color: white; }
        .btn-offline { background: linear-gradient(90deg, #f59e0b, #d97706); color: white; }
        
        .prompt-card { background: #111827; border-left: 4px solid; padding: 15px; margin-bottom: 10px; border-radius: 8px; }
        #output-area { display: none; margin-top: 30px; border-top: 1px dashed rgba(255,255,255,0.1); padding-top: 20px; }
        .show { display: block !important; }
        
        .loader-spin { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="cyber-wrapper flex flex-col items-center">
        <h1 class="text-4xl md:text-6xl font-extrabold text-white mb-2">MASTER PRO</h1>
        <p class="text-[10px] text-gray-400 uppercase tracking-widest mb-8">Stable Prompt Engine</p>

        <div class="grid grid-cols-3 gap-4 w-full mb-6">
            <button onclick="setMode('A')" id="btn-a" class="android-btn btn-strict">STRICT</button>
            <button onclick="setMode('B')" id="btn-b" class="android-btn btn-auto selected">AUTO</button>
            <button onclick="setMode('R')" id="btn-r" class="android-btn btn-reverse">REVERSE</button>
        </div>

        <div class="w-full space-y-4">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-[10px] text-gray-400 uppercase font-bold ml-1">Project Name</label>
                    <input type="text" id="project_name" placeholder="Project X" class="w-full input-3d p-3 text-sm">
                </div>
                <div>
                    <label class="text-[10px] text-gray-400 uppercase font-bold ml-1">Stages</label>
                    <select id="total_stages" class="w-full input-3d p-3 bg-[#0f172a] text-sm">
                        <option value="3">3 Stages</option>
                        <option value="4">4 Stages</option>
                        <option value="5">5 Stages</option>
                        <option value="6" selected>6 Stages</option>
                        <option value="7">7 Stages</option>
                    </select>
                </div>
            </div>

            <div id="dynamic-inputs">
                <div id="input-b">
                    <div class="flex justify-between items-end mb-1">
                        <label class="text-[10px] text-gray-400 uppercase font-bold ml-1">Description / Concept</label>
                        <button onclick="getSuggestion()" class="text-[10px] bg-purple-600 px-2 py-1 rounded text-white font-bold hover:bg-purple-500">✨ SUGGESTION</button>
                    </div>
                    <textarea id="auto_desc" class="w-full input-3d p-3 h-32 text-sm font-mono" placeholder="Write your idea or click Suggestion..."></textarea>
                </div>
                <div id="input-a" class="hidden space-y-2"></div>
                <div id="input-r" class="hidden">
                    <label class="text-[10px] text-gray-400 uppercase font-bold ml-1">Final Image Description</label>
                    <textarea id="rev_desc" class="w-full input-3d p-3 h-24 text-sm" placeholder="Describe the finished building..."></textarea>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3 mt-4">
                <button onclick="generate('online')" class="round-btn btn-online">
                    <i class="fas fa-cloud-bolt"></i> Generate Online
                </button>
                <button onclick="generate('offline')" class="round-btn btn-offline">
                    <i class="fas fa-microchip"></i> Generate Offline
                </button>
            </div>
        </div>

        <div id="output-area" class="w-full">
            <div id="loading" class="hidden text-center py-4">
                <i class="fas fa-circle-notch loader-spin text-blue-400 text-2xl"></i>
                <p class="text-xs text-blue-300 mt-2 font-mono">PROCESSING...</p>
            </div>
            
            <div id="results" class="space-y-4 hidden">
                <div class="flex justify-between items-center border-b border-gray-700 pb-2 mb-4">
                    <h3 class="text-lg font-bold text-white">GENERATED PROMPTS</h3>
                    <button onclick="copyAll()" class="text-xs bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded text-white font-bold">COPY ALL</button>
                </div>
                <div id="prompts-container" class="space-y-4"></div>
            </div>
        </div>
        
        <div class="text-center mt-10 w-full pt-4 border-t border-gray-800">
            <p class="text-[9px] text-gray-600 font-mono">SYSTEM ARCHITECT: OLIULLAH SHIKDER JEWEL</p>
        </div>
    </div>

    <script>
        // --- DATA & STATE ---
        const suggestions = [
            "A modern glass villa in the middle of a dense bamboo forest.",
            "Renovation of an old colonial brick house into a modern cafe.",
            "A futuristic pod house floating on a lake in Rangamati.",
            "A luxury wooden cottage on top of a hill in Bandarban.",
            "A traditional mud house with modern interior and glass roof."
        ];
        
        let currentMode = 'B'; // Default mode

        // --- UI FUNCTIONS ---
        function setMode(mode) {
            currentMode = mode;
            // Update Buttons
            ['a', 'b', 'r'].forEach(m => document.getElementById(`btn-${m}`).classList.remove('selected'));
            document.getElementById(`btn-${mode.toLowerCase()}`).classList.add('selected');
            
            // Show/Hide Inputs
            document.getElementById('input-b').classList.add('hidden');
            document.getElementById('input-a').classList.add('hidden');
            document.getElementById('input-r').classList.add('hidden');
            
            if (mode === 'B') document.getElementById('input-b').classList.remove('hidden');
            else if (mode === 'R') document.getElementById('input-r').classList.remove('hidden');
            else if (mode === 'A') {
                document.getElementById('input-a').classList.remove('hidden');
                renderStrictInputs();
            }
        }

        function renderStrictInputs() {
            const count = document.getElementById('total_stages').value;
            const container = document.getElementById('input-a');
            container.innerHTML = "";
            for(let i=0; i<count; i++) {
                container.innerHTML += `<input type="text" id="strict_${i}" placeholder="Stage ${i+1} description..." class="w-full input-3d p-2 text-xs">`;
            }
        }

        document.getElementById('total_stages').addEventListener('change', () => {
            if(currentMode === 'A') renderStrictInputs();
        });

        function getSuggestion() {
            const random = suggestions[Math.floor(Math.random() * suggestions.length)];
            document.getElementById('auto_desc').value = random;
        }

        // --- CORE GENERATION LOGIC ---
        async function generate(source) {
            // 1. Get Input Safely
            let contextText = "";
            const stages = parseInt(document.getElementById('total_stages').value);
            const projName = document.getElementById('project_name').value || "Project";
            
            if (currentMode === 'B') {
                contextText = document.getElementById('auto_desc').value.trim();
                if (!contextText) return alert("Please enter a description!");
            } else if (currentMode === 'R') {
                contextText = document.getElementById('rev_desc').value.trim();
                if (!contextText) return alert("Please enter a description!");
            } else {
                for(let i=0; i<stages; i++) {
                    const val = document.getElementById(`strict_${i}`).value;
                    contextText += `Stage ${i+1}: ${val}. `;
                }
            }

            // 2. Show Loader
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');

            // 3. Process
            try {
                let data = null;
                
                if (source === 'online') {
                    // ONLINE FETCH
                    const prompt = `Generate JSON with 'images' (array of prompt strings) and 'videos' (array of prompt strings) for construction project: "${contextText}". Stages: ${stages}. Logic: ${currentMode === 'R' ? 'Reverse demolition' : 'Construction/Renovation'}.`;
                    
                    const res = await fetch('https://text.pollinations.ai/', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ messages: [{ role: 'system', content: prompt }], model: 'openai' })
                    });
                    const txt = await res.text();
                    const jsonMatch = txt.match(/\{[\s\S]*\}/);
                    if (jsonMatch) data = JSON.parse(jsonMatch[0]);
                    else throw new Error("Invalid API Response");
                    
                } else {
                    // OFFLINE LOGIC
                    await new Promise(r => setTimeout(r, 500)); // Fake delay
                    data = generateOfflineLogic(contextText, stages, currentMode);
                }

                renderOutput(data);

            } catch (error) {
                console.error(error);
                alert("Online Generation Failed. Switching to Offline Logic.");
                // Fallback to offline
                const fallbackData = generateOfflineLogic(contextText, stages, currentMode);
                renderOutput(fallbackData);
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        // --- OFFLINE ENGINE ---
        function generateOfflineLogic(text, count, mode) {
            const images = [];
            const videos = [];
            const desc = text.substring(0, 200); // Truncate for safety
            
            // Detect Material
            let material = "Concrete/Modern";
            if (desc.toLowerCase().includes('bamboo') || desc.includes('বাঁশ')) material = "Bamboo";
            else if (desc.toLowerCase().includes('wood') || desc.includes('কাঠ')) material = "Wood";
            
            // Image Prompts
            for(let i=0; i<count; i++) {
                let prompt = "";
                const base = `, REALISTIC, 8k, 9:16 vertical ratio.`;
                
                if (mode === 'R') {
                    // Reverse
                    if(i===0) prompt = `PROMPT: (Stage 1 - Final) Completed masterpiece: ${desc}${base}`;
                    else prompt = `PROMPT: (Stage ${i+1} - Demolition) Demolishing structure, removing parts${base}`;
                } else {
                    // Construction/Renovation
                    if(i===0) prompt = `PROMPT: (Stage 1 - Base) Empty land or Broken structure context for: ${desc}${base}`;
                    else if(i===1) prompt = `PROMPT: (Stage 2 - Foundation/Cleaning) Site cleared, foundation work starting for ${material} structure${base}`;
                    else if(i===count-1) prompt = `PROMPT: (Final) Completed Project: ${desc}. Luxury lighting, landscaping${base}`;
                    else prompt = `PROMPT: (Stage ${i+1} - Construction) Building the ${material} structure. Walls rising, roof framing${base}`;
                }
                images.push(prompt);
                
                // Video Prompts (N-1)
                if (i < count - 1) {
                    videos.push(`VIDEO PROMPT: Cinematic shot of workers building with ${material}, timelapse style. 4k.`);
                }
            }
            
            return { images, videos };
        }

        // --- RENDER OUTPUT ---
        function renderOutput(data) {
            const container = document.getElementById('prompts-container');
            container.innerHTML = "";
            
            // Images
            data.images.forEach((txt, i) => {
                container.innerHTML += `
                <div class="prompt-card border-pink-500">
                    <div class="flex justify-between mb-1">
                        <span class="text-[10px] text-pink-400 font-bold">IMAGE ${i+1}</span>
                        <i class="fas fa-copy text-gray-500 cursor-pointer" onclick="navigator.clipboard.writeText(this.nextElementSibling.innerText)"></i>
                        <span class="hidden">${txt}</span>
                    </div>
                    <p class="text-xs text-gray-300 font-mono select-all">${txt}</p>
                </div>`;
            });

            // Videos
            if(data.videos) {
                data.videos.forEach((txt, i) => {
                    container.innerHTML += `
                    <div class="prompt-card border-blue-500">
                        <div class="flex justify-between mb-1">
                            <span class="text-[10px] text-blue-400 font-bold">VIDEO ${i+1}</span>
                            <i class="fas fa-copy text-gray-500 cursor-pointer" onclick="navigator.clipboard.writeText(this.nextElementSibling.innerText)"></i>
                            <span class="hidden">${txt}</span>
                        </div>
                        <p class="text-xs text-gray-300 font-mono select-all">${txt}</p>
                    </div>`;
                });
            }

            document.getElementById('results').classList.remove('hidden');
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        function copyAll() {
            const els = document.querySelectorAll('.select-all');
            let txt = "";
            els.forEach(el => txt += el.innerText + "\n\n");
            navigator.clipboard.writeText(txt);
            alert("All prompts copied!");
        }
    </script>
</body>
</html>
